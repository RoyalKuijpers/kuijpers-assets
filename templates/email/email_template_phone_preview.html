<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Email template phone preview</title>
  <style>
    :root {
      --panel-bg: rgba(255,255,255,0.78);
      --panel-border: rgba(255,255,255,0.35);
      --text: #111827;
      --muted: #6b7280;
      --shadow: 0 18px 55px rgba(0,0,0,0.35);
      --phone-shadow: 0 22px 70px rgba(0,0,0,0.55);
      --radius: 18px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: #0b1220 url("blurred_office_bg.jpg") center/cover no-repeat fixed;
    }

    /* subtle frosted overlay */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(10, 14, 20, 0.45);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      pointer-events: none;
    }

    .app {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 20px;
      min-height: 100%;
      padding: 22px;
      align-items: center;
    }

    .panel {
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }

    .panel h1 {
      margin: 0 0 10px 0;
      font-size: 16px;
      line-height: 1.2;
    }

    .panel p {
      margin: 0 0 14px 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin: 12px 0 6px;
    }

    select, button, input[type="text"] {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(17, 24, 39, 0.15);
      padding: 10px 12px;
      font-size: 14px;
      background: rgba(255,255,255,0.92);
      color: var(--text);
      outline: none;
    }

    select:focus, button:focus, input[type="text"]:focus {
      border-color: rgba(17, 24, 39, 0.35);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }

    button {
      cursor: pointer;
      font-weight: 600;
    }

    .hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
    }

    .link {
      display: inline-block;
      margin-top: 10px;
      font-size: 13px;
      text-decoration: none;
      color: #0b5bd3;
      word-break: break-all;
    }

    .stage {
      display: grid;
      place-items: center;
      padding: 10px;
    }

    .phone {
      position: relative;
      width: min(420px, 58vw);
      aspect-ratio: 355 / 755;
      filter: drop-shadow(var(--phone-shadow));
    }

    .phone img.frame {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
      user-select: none;
    }

    /* Screen region (tuned for provided PNG 355x755) */
    .screen {
      position: absolute;
      left: 6.8%;
      right: 6.8%;
      top: 8.3%;
      bottom: 5.6%;
      border-radius: 38px;
      overflow: hidden;
      background: #0b0b0b;
    }

    .screen::before {
      /* fallback background while template loads */
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
      pointer-events: none;
      z-index: 1;
    }

    iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      background: white;
      overflow: auto;
    }

    /* Loading overlay */
    .loading {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.92);
      font-size: 13px;
      letter-spacing: 0.2px;
      z-index: 2;
      opacity: 0;
      transition: opacity 160ms ease;
      pointer-events: none;
    }
    .loading.on {
      opacity: 1;
    }

    .error {
      position: absolute;
      inset: 0;
      padding: 16px;
      display: none;
      background: #111827;
      color: rgba(255,255,255,0.92);
      font-size: 13px;
      line-height: 1.35;
      z-index: 3;
    }
    .error a { color: #93c5fd; }

    /* Responsive layout */
    @media (max-width: 900px) {
      .app {
        grid-template-columns: 1fr;
        align-items: start;
        padding: 14px;
      }
      .phone {
        width: min(420px, 92vw);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="panel" aria-label="Template controls">
      <h1>Email template preview</h1>
      <p>Pick a template to load it inside the phone. The page scrolls inside the screen area.</p>

      <label for="templateSelect">Template</label>
      <select id="templateSelect"></select>

      <div class="row">
        <button id="reloadBtn" type="button">Reload</button>
        <button id="copyBtn" type="button">Copy URL</button>
      </div>

      <a id="openLink" class="link" href="https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%201%20Eerste%20mail%20%5Baanvrager%5D.html" target="_blank" rel="noopener">Open template in new tab</a>

      <div class="hint">
        Notes:
        <ul style="margin:8px 0 0 18px; padding:0; color: var(--muted);">
          <li>If the template host sets <code>X-Frame-Options</code> / CSP to block iframes, it may not render here. Use “Open template in new tab”.</li>
          <li>Email-client quirks (Outlook/Apple Mail/Gmail) are best validated with real send/tests; this preview is for layout/responsiveness only.</li>
        </ul>
      </div>
    </aside>

    <main class="stage">
      <div class="phone" aria-label="Phone preview">
        <div class="screen">
          <div id="loading" class="loading on">Loading template…</div>
          <div id="error" class="error">
            <strong>Could not load in the phone preview.</strong><br/><br/>
            This usually happens when the hosting server blocks embedding in an iframe via security headers (X-Frame-Options / CSP).<br/><br/>
            You can still open the template directly:
            <a id="errorLink" href="https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%201%20Eerste%20mail%20%5Baanvrager%5D.html" target="_blank" rel="noopener">open template</a>
          </div>
          <iframe id="preview" title="Template preview" src="https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%201%20Eerste%20mail%20%5Baanvrager%5D.html" loading="eager"></iframe>
        </div>
        <img class="frame" src="iPhone_Mockuppng.png" alt="Phone frame" />
      </div>
    </main>
  </div>

  <script>
    const templates = [{"name": "KVA Badge Proces - Stap 1 Eerste mail [aanvrager]", "url": "https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%201%20Eerste%20mail%20%5Baanvrager%5D.html"}, {"name": "KVA Badge Proces - Stap 2 Mail met gegevens aanvrager [CRE Projectsupport]", "url": "https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%202%20Mail%20met%20gegevens%20aanvrager%20%5BCRE%20Projectsupport%5D.html"}, {"name": "KVA Badge Proces - Stap 2 NOK 1 Naam of Email bestaat al [aanvrager]", "url": "https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%202%20NOK%201%20Naam%20of%20Email%20bestaat%20al%20%5Baanvrager%5D.html"}, {"name": "KVA Badge Proces - Stap 2 NOK 2 Speciale reden [aanvrager]", "url": "https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%202%20NOK%202%20Speciale%20reden%20%5Baanvrager%5D.html"}, {"name": "KVA Badge Proces - Stap 2 OK Aanvraag in behandeling bij ASML [aanvrager]", "url": "https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%202%20OK%20Aanvraag%20in%20behandeling%20bij%20ASML%20%5Baanvrager%5D.html"}];
    const sel = document.getElementById('templateSelect');
    const frame = document.getElementById('preview');
    const loading = document.getElementById('loading');
    const errorBox = document.getElementById('error');
    const openLink = document.getElementById('openLink');
    const errorLink = document.getElementById('errorLink');

    function setLoading(on) {
      loading.classList.toggle('on', !!on);
    }

    function setError(on) {
      errorBox.style.display = on ? 'block' : 'none';
    }

    function loadTemplate(url) {
      setError(false);
      setLoading(true);
      openLink.href = url;
      errorLink.href = url;

      // Force reload even if same URL
      frame.src = url;
    }

    // Populate dropdown
    templates.forEach((t, idx) => {
      const opt = document.createElement('option');
      opt.value = t.url;
      opt.textContent = t.name;
      sel.appendChild(opt);
    });
    sel.value = "https://royalkuijpers.github.io/assets/templates/email/KVA%20Badge%20Proces%20-%20Stap%201%20Eerste%20mail%20%5Baanvrager%5D.html";

    // Events
    sel.addEventListener('change', (e) => loadTemplate(e.target.value));
    document.getElementById('reloadBtn').addEventListener('click', () => loadTemplate(sel.value));
    document.getElementById('copyBtn').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(sel.value);
        const btn = document.getElementById('copyBtn');
        const old = btn.textContent;
        btn.textContent = 'Copied';
        setTimeout(() => btn.textContent = old, 900);
      } catch (err) {
        prompt('Copy this URL:', sel.value);
      }
    });

    // iframe load/error handling
    frame.addEventListener('load', () => {
      setLoading(false);
      // If embedding is blocked, browsers typically show a blank frame; we can't reliably detect that.
      // Keep error hidden unless the iframe fires an error (rare).
    });
    frame.addEventListener('error', () => {
      setLoading(false);
      setError(true);
    });

    // Initial load
    loadTemplate(sel.value);
  </script>
</body>
</html>
